# ═════════════════════════════════════════════════════════════════════════════
# 🗄️   v
# Release: 
# 
# Conditionally enabled when: openwebui.providers.vector_db == "qdrant"
# ═════════════════════════════════════════════════════════════════════════════

[Unit]
Description=Qdrant Vector Database
After=network-online.target llm.network.service
Requires=llm.network.service

[Container]
Image=
AutoUpdate=registry
ContainerName=qdrant

# ═════════════════════════════════════════════════════════════════════════════
# 🌐 NETWORK
# ═════════════════════════════════════════════════════════════════════════════
Network=llm.network

# ═════════════════════════════════════════════════════════════════════════════
# 📍 PUBLISHED PORT (for Caddy to access dashboard)
# ═════════════════════════════════════════════════════════════════════════════
PublishPort=127.0.0.1:6333:6333


# ═════════════════════════════════════════════════════════════════════════════
# 💾 VOLUME - Persistent storage for vector data
# ═════════════════════════════════════════════════════════════════════════════
Volume=qdrant.volume:/qdrant/storage:Z


# ═════════════════════════════════════════════════════════════════════════════
# 🌍 ENVIRONMENT - Configuration
# ═════════════════════════════════════════════════════════════════════════════

# Disable telemetry (privacy first)
Environment=QDRANT__TELEMETRY_DISABLED=true

# Logging
Environment=QDRANT__LOG_LEVEL=INFO

# ═════════════════════════════════════════════════════════════════════════════
# 🔧 HEALTH CHECK
# ═════════════════════════════════════════════════════════════════════════════
HealthCmd=timeout 3s bash -c ':> /dev/tcp/127.0.0.1/6333' || exit 1
HealthInterval=30s
HealthTimeout=5s
HealthRetries=3
HealthStartPeriod=20s

# ═════════════════════════════════════════════════════════════════════════════
# 🚀 SERVICE
# ═════════════════════════════════════════════════════════════════════════════
[Service]
Slice=llm.slice
TimeoutStartSec=900
Restart=on-failure
RestartSec=10


[Install]
# No WantedBy - dependencies via After/Requires
